<html lang="pt"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Inovar | Formulário de Acabamentos e Adicionais</title>
    <link rel="icon" href="./assets/icons/icon.png" type="image/png">


    <!-- Stylesheet -->
    <link rel="stylesheet" href="./colors.css">
    <link rel="stylesheet" href="./style/main.css">
    <link rel="stylesheet" href="./style/scrollBar.css">
    <link rel="stylesheet" href="./style/radio.css">
    <link rel="stylesheet" href="./style/imageCheckBox.css">
    <link rel="stylesheet" href="./style/colorInput.css">
    <link rel="stylesheet" href="./style/dateInput.css">

    
    <!-- Icones Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


</head>


<body>
    <header>
        <a href="" class="docs-creator">
            <img class="logo" src="./assets/icons/icon.png" alt="">
        </a>
        <h1>Acabamentos e Adicionais</h1>
    </header>

    <div class="mainContainer">
        <h2 class="title">
            Formulário
        </h2>
        <p>
            Marque as opções que você deseja e toque no botão do Whatsapp no final da página.
        </p>
        <br>
    </div>

        
    <form class="formSection">
        <!-- Capa -->
        <div class="mainContainer">
            <h2 class="title">
                Informações da Capa
            </h2>

            <hr>

            <!-- Acabamento -->
            <div class="inputDiv">
                <h3>Acabamentos</h3><br>

                <sup class="mandatory"></sup> <br>
                <span class="title">Informe a laminação da capa e contracapa: </span><br><br>
                <span>As opções com <span class="favorite"></span> são as favoritas dos nossos clientes!</span>
                
                <div id="acabamentos" class="imageCheckBoxWrapper selectOnlyOne"></div>
            </div>
            
        </div>
        
        <!-- Adicionais -->
        <div class="mainContainer">
            <h2 class="title">
                Adicionais
            </h2>
            <hr>

            <div class="inputDiv">
                <h3>Página Destaque</h3><br>
                <span class="title">A primeira página pode ser especial com o Bolso Canguru (um bolsinho para guardar documentos e outras coisas) ou a Folha de Fotos (Uma página com algumas imagens da sua preferencia)
                    <br><br>
                    Escolha uma das opções abaixo:
                </span>
                
                <div id="bolso" class="imageCheckBoxWrapper selectOnlyOne additionals"></div>
                
                <br>
                <br>
                <span class="title"> Caso escolha uma opção com fotos, lembre de enviar as fotos para o designer! </span>
            </div>
            

            <hr>

            <div class="inputDiv">
                <h3>Elásticos</h3><br>
                <span class="title">Essas são as opções de Elásticos que temos:</span> <br><br>
                <span>As opções com <span class="favorite"></span> são as favoritas dos nossos clientes!</span>

                
                <div id="elasticos" class="imageCheckBoxWrapper selectOnlyOne additionals"></div>
                
            </div>
            <div class="inputDiv" id="elasticoPeB">                
                <div>                    
                    <h3>Cor do Elástico</h3><br>
                    <sup class="mandatory"></sup> <br>
                    <span class="title">Selecione a cor que você quer para o Elástico:</span>

                    
                    <div id="elastico" class="imageCheckBoxWrapper selectOnlyOne minified"></div>
                </div>
            </div>
            <div class="inputDiv" id="elasticoColorido">                
                <div>                    
                    <h3>Cor do Elástico</h3><br>
                    <sup class="mandatory"></sup> <br>
                    <span class="title">Selecione a cor que você quer para o Elástico:</span>

                    
                    <div id="elastico-colorido" class="imageCheckBoxWrapper selectOnlyOne minified"></div>
                </div>
            </div>
            <div class="inputDiv" id="elasticoGlitter">                
                <div>                    
                    <h3>Cor do Elástico com Glitter</h3><br>
                    <sup class="mandatory"></sup> <br>
                    <span class="title">Selecione a cor que você quer para o Elástico com Glitter:</span>

                    
                    <div id="elastico-glitter" class="imageCheckBoxWrapper selectOnlyOne minified"></div>
                </div>
            </div>


            <hr>

            <div class="inputDiv">
                <h3>Itens Adicionais</h3><br>
                <span class="title">Alguns itens Adicionais para dar mais vida ao seu pedido:</span> <br><br>
                <span>As opções com <span class="favorite"></span> são as favoritas dos nossos clientes!</span>

                
                <div id="adicionais" class="imageCheckBoxWrapper additionals"></div>
                
            </div> 

            <div class="inputDiv" id="pingente">                
                <div>                    
                    <h3>Cor do Pingente</h3><br>
                    <sup class="mandatory"></sup> <br>
                    <span class="title">Selecione a cor que você quer para o Pingente:</span>

                    
                    <div id="pingentes" class="imageCheckBoxWrapper selectOnlyOne minified"></div>
                </div>
            </div>
            <div class="inputDiv" id="pingenteLuxo">                
                <div>                    
                    <h3>Cor do Pingente Luxo</h3><br>
                    <sup class="mandatory"></sup> <br>
                    <span class="title">Selecione a cor que você quer para o Pingente Luxo:</span>

                    
                    <div id="pingentes-Luxo" class="imageCheckBoxWrapper selectOnlyOne minified"></div>
                </div>
            </div>

        </div>
        
        <div class="mainContainer noHeaderLine submit">
            <button class="submitButton"> 
                <svg width="23" height="23" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M0.629883 28.9754L2.62298 21.6971C1.39356 19.5669 0.746885 17.1505 0.747788 14.675C0.75095 6.93056 7.05323 0.629883 14.7975 0.629883C18.5555 0.631464 22.083 2.09421 24.7356 4.74909C27.388 7.40398 28.8483 10.933 28.8469 14.6863C28.8436 22.4305 22.5404 28.7321 14.7975 28.7321C14.7977 28.7321 14.797 28.7321 14.7975 28.7321H14.7914C12.4401 28.7312 10.1298 28.1414 8.07779 27.0222L0.629883 28.9754ZM8.42269 24.4796L8.84936 24.7324C10.6419 25.7962 12.6971 26.3589 14.793 26.36H14.7975C21.2335 26.36 26.4719 21.1225 26.4746 14.6854C26.4757 11.5659 25.2624 8.6325 23.0576 6.42596C20.8527 4.21943 17.9211 3.00356 14.8018 3.00221C8.36058 3.00221 3.12238 8.23903 3.1199 14.6759C3.11899 16.8818 3.73607 19.0298 4.90519 20.8887L5.18301 21.3305L4.00306 25.6383L8.42269 24.4796Z" fill="white"></path>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.286 8.80331C11.0231 8.21875 10.7462 8.207 10.4959 8.19684C10.2913 8.18803 10.0571 8.18848 9.8233 8.18848C9.5893 8.18848 9.20893 8.27657 8.88729 8.6278C8.56542 8.97904 7.65833 9.82832 7.65833 11.5556C7.65833 13.283 8.91643 14.952 9.09193 15.1865C9.26743 15.4207 11.5205 19.0785 15.0886 20.4857C18.054 21.6552 18.6573 21.4226 19.3011 21.3641C19.9448 21.3056 21.378 20.5148 21.6705 19.6951C21.9632 18.8754 21.9632 18.173 21.8753 18.0259C21.7875 17.8798 21.5535 17.7919 21.2025 17.6164C20.8515 17.4409 19.1256 16.5914 18.8037 16.4744C18.4818 16.3572 18.2478 16.2989 18.0138 16.6504C17.7796 17.0014 17.1074 17.7919 16.9026 18.0259C16.6977 18.2606 16.4928 18.29 16.1418 18.1142C15.7908 17.9383 14.6601 17.5678 13.3189 16.3719C12.2754 15.4415 11.5706 14.2922 11.3658 13.9408C11.1611 13.5898 11.3624 13.4163 11.52 13.2245C11.804 12.8792 12.2803 12.2583 12.3973 12.0243C12.5143 11.7898 12.4558 11.5849 12.3682 11.4092C12.2803 11.2337 11.598 9.49764 11.286 8.80331Z" fill="white"></path>
                </svg>
                    
                Envie suas respostas
            </button>
        </div>

        <div class="mainContainer ">
            <h2 class="title">
                Créditos
            </h2>
            <hr>
            <br>
            <span class="title">
                Formulário criado por <a href="https://github.com/NaN-NaN-sempai" class="docs-creator">Luís Henrique de Almeida</a> - Desenvolvedor &amp; Desiner UI/UX.
            </span>
        </div>
    </form>
</body>


<!-- functions -->
<script>
    let defaultNumber = "5574981395580";
    function getNumber() {
        let url = window.location.href;

        if (url.includes('#')) {
            const split = url.split('#');
            return split[1];
        } else {
            return defaultNumber;
        }
    }

    const toggleInput = (selector, bool) => {
        document.querySelector(selector).style.display = bool? "block": "none";
        [...document.querySelectorAll(selector + " input")].forEach(input => {
            if(!bool && !input.name.includes("_ignore")){
                input.name += "_ignore";
            } else {
                input.name = input.name.replace("_ignore", "")
            } 
        });
    }

    const insertImageCheckboxValues = (selector, insertList) => {
        var insertEl = document.querySelector(selector);
        insertList.forEach((a, i) => {
            var isMandatory = insertEl.parentNode.querySelector(".mandatory");
            
            var favorite = a.favorite? " favorite": "";
            var firstSelected = (!i && isMandatory? " selected": "");

            var imageCheckBoxContainer = document.createElement("div");
                imageCheckBoxContainer.className = "imageCheckBoxContainer" + firstSelected + favorite;

                var id = insertEl.id + "-" + i;

                var input = document.createElement("input");
                    input.type = "checkbox";
                    input.id = id;
                    input.name = selector.slice(1);
                    input.value = a.sendValue? a.sendValue: a.name;
                    input.checked = firstSelected != "";

                var label = document.createElement("label");
                    label.htmlFor = id;

                    var labelSelector = document.createElement("div");
                        labelSelector.className = "labelSelector";

                        var img = document.createElement("img");
                            img.src = a.img

                        var name = document.createElement("p");
                            name.className = "name";
                            name.innerHTML = '<span class="insertIcon"></span> ' + a.name;

                        if(a.price != undefined){
                            var hr = document.createElement("hr");

                            let shownPrice;
                            if(!isNaN(a.price))
                                if(a.price) shownPrice = "R$ " + a.price.toFixed(2);
                                else shownPrice = "Gratuito";
                            else
                                shownPrice = a.price

                            var price = document.createElement("p");
                                price.className = "price";
                                price.innerHTML = "(" + shownPrice + ")";

                            var hidden = document.createElement("input");
                                hidden.type = "checkbox";
                                hidden.style.display = "none";
                                hidden.name = selector.slice(1) + "_price";
                                hidden.value = a.price;
                                hidden.checked = firstSelected != "";
                                
                            input.addEventListener("input", ()=>{
                                hidden.checked = input.checked;
                            });
                        }
                        
                    labelSelector.append(img, name, hr?hr:"", price?price:"");
                label.append(labelSelector);
            imageCheckBoxContainer.append(input, hidden?hidden:"", label);

            insertEl.append(imageCheckBoxContainer);

            if(a.callback) a.callback(imageCheckBoxContainer);
        });
    }

    const formOutput = (evt) => {
        evt.preventDefault();

        let data = new FormData(evt.target);
        //let formObject = Object.fromEntries(data); 


        var object = {};
        data.forEach(function(value, key){
            if(key.includes("_ignore")) return;
            if(object[key])
                if(!Array.isArray(object[key]))
                    object[key] = [object[key], value];
                else 
                    object[key].push(value);
            else
                object[key] = value;
        });
        console.log(object);
        

        const setupPrice = (n) => {
            if(n) return "R$ " + n.toFixed(2);
            else return "Gratuito";
        }
        function capitalize(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        function sendWhatsapp(mensagem) {
            var linkWhatsApp = 'https://api.whatsapp.com/send?phone=' + getNumber() + '&text=' + encodeURIComponent(mensagem);

            window.open(linkWhatsApp, '_blank');
        }
        const setupLine = (key, sum, value) => {
            if(sum == "ignore") return output.push(`*${capitalize(key)}*:\n${'`'+value.join(" / ")+'`'}`);
            output.push(`*${capitalize(key)}*: ${setupPrice(sum)}\n${'`'+value.join(" / ")+'`'}`);
        }

        let output = [];
        let total = []; 
        let totalValue = 0; 
        for(key in object) {
            let price = object[key+"_price"];

            if(price){
                let sum = price;
                let value = object[key];
                if(Array.isArray(price))
                    sum = price.map(parseFloat).reduce((a, b) => a + b);
                else
                    value = [value];
                
                total = total.concat(value);
                totalValue += parseFloat(sum);

                setupLine(key, parseFloat(sum), value);
            } else if(!key.includes("_price")) {
                let value = [object[key]];
                total = total.concat(value);
                setupLine(key, "ignore", value);
            }
        }

        total = total.filter(e => ![
            "Pingente",
            "Pingente Luxo",
            "Elástico Preto ou Branco",
            "Elástico Colorido",
            "Elástico com Glitter",
        ].includes(e));

        if(output.length-1)
            setupLine("Total", totalValue, total);

        output.unshift(output.at(-1));
        output.pop();        

        let outputText = "*Formulário de Acabamentos e Adicionais:*\n\n" + output.join("\n\n")
        console.log(outputText);

        //sendWhatsapp(outputText);
    }

    document.querySelectorAll(".formSection").forEach(f => {
        f.addEventListener("submit", formOutput);
    });
</script>

<script src="./lists/acabamentos.js"></script>
<script src="./lists/paginaDestaque.js"></script>
<script src="./lists/elasticoPeb.js"></script>
<script src="./lists/elasticoColorido.js"></script>
<script src="./lists/elasticoGlitter.js"></script>
<script src="./lists/elasticos.js"></script>
<script src="./lists/pingentes.js"></script>
<script src="./lists/pingentesLuxo.js"></script>
<script src="./lists/adicionais.js"></script>
<script src="./scripts/nameThatColor.js"></script>

<!-- setup -->
<script>

    // check box add style
    Array.from(document.querySelectorAll(".imageCheckBoxWrapper input")).forEach(e => {
        e.addEventListener("input", () => {
            if(e.checked){
                e.parentNode.classList.add("selected");
                
            } else {
                e.parentNode.classList.remove("selected");
            }
        })
    })


    // select only one script
    Array.from(document.querySelectorAll(".selectOnlyOne")).forEach(c => {
        Array.from(document.querySelectorAll("#"+c.id+" label")).forEach(e => {

            e.addEventListener("click", (evt) => {
                var selected = e.htmlFor;

                var isMandatory = e.parentNode?.parentNode?.parentNode?.querySelector(".mandatory");

                if(isMandatory && e.parentNode.classList.contains("selected")){
                    evt.preventDefault();
                    return
                }
                
                Array.from(document.querySelectorAll("#"+e.parentNode.parentNode.id+" input")).forEach(i => {
                    if(i.id != selected){ 
                        if(i.checked) i.click();
                        //i.checked = false;
                        i.parentNode.classList.remove("selected");
                    }
                    
                })
                
            })
            
        })
    });

    // show input colors values
    document.querySelectorAll(".inputColor").forEach(e => {
        var input = e.querySelector("input");
        var output = e.querySelector(".outputColor");
        var name = e.querySelector(".name");

        output.innerHTML = input.value;
        name.innerHTML = nameThatColor(input.value).name;

        e.addEventListener("input", () => {
            output.innerHTML = input.value;
            name.innerHTML = nameThatColor(input.value).name;
        })
    });
</script>
</html>